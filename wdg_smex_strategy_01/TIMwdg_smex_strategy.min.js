(function(){$.fn.wdgStrategyMxM=function(b){var c=$.extend({ideventomxm:0,ideventomxmtv:0,idclub:0},b);var a=this;var d={urlFinalAlienacion:"http://static-televisadeportes.esmas.com/sportsdata/futbol/data/"+c.ideventomxm+"/"+c.ideventomxmtv+"/match_lineup.js",urlDropdown:"http://lab.israelviveros.com/deportes/wdg_smex_strategy_01/"+c.ideventomxm+"/"+c.idclub+"/matchesclub.js",urlmxmheader:"http://static-televisadeportes.esmas.com/sportsdata/futbol/data/"+c.ideventomxm+"/"+c.ideventomxmtv+"/match_header.js",PintaCacha:function(e){var f="";
if(e==="dropdown"){f+='<div class="titulo textcolor-title4">Estrategia m치s utilizada</div>';f+='<div class="pleca_inferior">';f+="<div>";f+="<strong>Partidos</strong>";
f+="</div>";f+='<div class="wdg_smex_strategy_01_dropdown">';f+='<div class="wdg_smex_strategy_01_dropdowncontent">';f+="<p></p>";f+='<div> <a id="dropdwon-right"  href="#" title="Link Description"> <i class="tvsa-caret-down"></i></a> </div>';
f+="</div>";f+='<div class="wdg_smex_strategy_01_listcontainer">';f+="</div>";f+="</div>";f+="</div>";}if(e==="alineacionFinal"){f+='<ul class="menu">';
f+='<li class="first active"><a href="#" data-query="inicial" class="ui-link">Alineaci칩n Inicial</a></li><li><a href="#" data-query="media" class="ui-link">Alineaci칩n Media</a></li><li><a href="#" data-query="final" class="ui-link">Alineaci칩n Final</a></li>';
f+="</ul>";}f+='<div class="field">';f+='<div id="LoadingCancha"><div id="fountainG_1" class="fountainG"></div><div id="fountainG_2" class="fountainG"></div><div id="fountainG_3" class="fountainG"></div><div id="fountainG_4" class="fountainG"></div><div id="fountainG_5" class="fountainG"></div><div id="fountainG_6" class="fountainG"></div><div id="fountainG_7" class="fountainG"></div><div id="fountainG_8" class="fountainG"></div></div>';
f+='<img class="cancha" src="http://lab.israelviveros.com/deportes/wdg_smex_strategy_01/cancha.png" alt="field" width="624" height="334"/>';f+='<span class="players">';
f+="</span>";f+="</div>";a.html(f).css("display","none").fadeIn("slow");(c.idclub!==0)?setTimeout(function(){d.loadDropdown();},1000):"";d.FunInicio();
(e==="alineacionFinal")?d.botonesAlineacion():"";(c.ideventomxm!==0&&c.ideventomxmtv!==0&&c.idclub===0)?d.header():"";},loadDropdown:function(){var e="";
$.ajax({url:d.urlDropdown,dataType:"jsonp",jsonpCallback:"matches",cache:false,}).done(function(g){e+='<ul class="wdg_smex_strategy_01_dropdownlist">';
for(var f=0;f<g.Team.length;f++){e+='<li><p data-field="'+g.Team[f].matchid+'">'+g.Team[f].week+"</p></li>";}e+="</ul>";$(".wdg_smex_strategy_01_listcontainer").html(e);
var h=$(".wdg_smex_strategy_01_dropdownlist li").eq(0).find("p").data("field");d.loadAlineacion(a,h);}).fail(function(){console.log("error al cargar DROPDOWN: "+d.urlDropdown);
});},loadAlineacion:function(f,g,e){f.find("span.players").fadeOut("fast");$.ajax({url:"http://static-televisadeportes.esmas.com/sportsdata/futbol/data/"+c.ideventomxm+"/"+g+"/match_lineup.js",dataType:"jsonp",jsonpCallback:"datagame",cache:false,success:function(H){var G="",z="",p=new Array();
var u=new Array();var q,s,j,l,E;u[0]="lineupLocal";u[1]="lineupVisit";for(var w=0;w<u.length;w++){l=String(u[w]);for(var A=0;A<H[l].team.length;A++){var m="";
var x="";var v="",C="";s=parseInt(H[l].team[A].posx);q=parseInt(H[l].team[A].posy);s=(isNaN(s))?0:s;q=(isNaN(q))?0:q;if(s<=290&&q<=140){m="grid1";}else{if(s<=290&&q>140){m="grid3";
}else{if(s>290&&q<=140){m="grid2";}else{m="grid4";}}}if(typeof H[l].team[A].actions!=="undefined"){v+='<em>acciones</em><span class="actions">';for(var F=0;
F<H[l].team[A].actions.length;F++){switch(H[l].team[A].actions[F].type){case"golVisitante":C="tvsa-mxm-goal";break;case"amonestacion":C="tvsa-mxm-owngoal";
break;case"saleDelJuego":C="tvsa-mxm-offside";break;case"entraAlJuego":C="tvsa-mxm-goal";break;case"expulsion":C="tvsa-mxm-redcard";break;default:C="";
break;}v+='<i class="'+C+'"></i>'+H[l].team[A].actions[F].minute+"'";}v+="</span>";}if(v==""){x+="noactions";}if(l==="lineupLocal"){j="local";}else{j="visit";
}E=(H[l].team[A].image!=="")?H[l].team[A].image:"http://i2.esmas.com/img/spacer.gif";G+='<span data-guid="'+H[l].team[A].idjugador+'" class="player '+j+" "+m+'" style="left:'+s+"px;top:"+q+'px;"><a href="#" title="'+H[l].team[A].name+" "+H[l].team[A].name+'"><span class="number textcolor-title2">'+H[l].team[A].number+'</span><span class="tooltip '+x+'"><img class="playerfoto" src="'+E+'" alt="'+H[l].team[A].name+'" width="51" height="38" /><span class="arrow"></span><span class="name">'+H[l].team[A].name+" "+H[l].team[A].nickName+'</span><span class="position textcolor-title2">'+H[l].team[A].position+"</span>"+v+"</span></a></span>";
}f.find("span.players").html(G).fadeIn("slow");$("#LoadingCancha").hide("slow");(e==="actualizacion")?"":$(".wdg_smex_strategy_01_dropdowncontent p").text(H.week);
if(e==="Alineacionfinal"){for(var D=0;D<H[l].substitutes.length;D++){if(typeof H[l].substitutes[D].actions!=="undefined"){if(typeof H[l].team[D].actions!=="undefined"){var h="";
h+='<em>acciones</em><span class="actions">';for(var F=0;F<H[l].team[D].actions.length;F++){switch(H[l].team[D].actions[F].type){case"golVisitante":C="tvsa-mxm-goal";
break;case"amonestacion":C="tvsa-mxm-owngoal";break;case"saleDelJuego":C="tvsa-mxm-offside";break;case"entraAlJuego":C="tvsa-mxm-goal";break;case"expulsion":C="tvsa-mxm-redcard";
break;default:C="";break;}h+='<i class="'+C+'"></i>'+H[l].team[D].actions[F].minute+"'";}h+="</span>";}if(h===""){x+="noactions";}if(l==="lineupLocal"){j="local";
}else{j="visit";}for(var B=0;B<H[l].substitutes[D].actions.length;B++){if(H[l].substitutes[D].actions[B].type==="entraAlJuego"){p.push(H[l].substitutes[D].actions[B].playeridchange);
var r=$("span[data-guid="+H[l].substitutes[D].actions[B].playeridchange+"]");var o=r.css("top");var n=r.css("left");o=(typeof n==="undefined")?0:o;n=(typeof n==="undefined")?0:n;
z+='<span data-guid="'+H[l].substitutes[D].idjugador+'" class="player '+j+" "+m+'" style="left:'+n+";top:"+o+'"><a href="#" title="'+H[l].substitutes[D].name+" "+H[l].substitutes[D].name+'"><span class="number textcolor-title2">'+H[l].substitutes[D].number+'</span><span class="tooltip"><img class="playerfoto" src="'+H[l].substitutes[D].image+'" alt="'+H[l].substitutes[D].name+'" width="51" height="38" /><span class="arrow"></span><span class="name">'+H[l].substitutes[D].name+" "+H[l].substitutes[D].nickName+'</span><span class="position textcolor-title2">'+H[l].substitutes[D].position+"</span>"+h+"</span></a></span>";
}}}}console.log(p);for(var y=0;y<p.length;y++){$("span[data-guid="+p[y]+"]").remove();}f.find("span.players").append(z).fadeIn("slow");}$(".grid3 .noactions").css("top","-90px");
$(".grid4 .noactions").css("top","-90px");}}}).fail(function(){$("#LoadingCancha").hide();});},FunInicio:function(){$("section.wdg_smex_strategy_01").each(function(){var g=(typeof exports=="undefined"?window:exports);
var h={check_mime_type:true};g.Retina=f;function f(){}f.configure=function(l){if(l==null){l={};}for(var m in l){h[m]=l[m];}};f.isRetina=function(){var l="(-webkit-min-device-pixel-ratio: 1.5),										   (min--moz-device-pixel-ratio: 1.5),										   (-o-min-device-pixel-ratio: 3/2),										   (min-resolution: 1.5dppx)";
if(g.devicePixelRatio>1){return true;}if(g.matchMedia&&g.matchMedia(l).matches){return true;}return false;};var i=$(this);if(f.isRetina()){var e=i.find("img.cancha").attr("src");
i.find("img.cancha").attr("src",e.replace(".png","@2x.png"));}if(c.ideventomxm!==0&&c.ideventomxmtv!==0){d.loadAlineacion(i,c.ideventomxmtv);}var i=$(".wdg_smex_strategy_01");
var k=i.find(".wdg_smex_strategy_01_dropdown");var j=$(".pleca_inferior .wdg_smex_strategy_01_dropdownlist li:first-child");$(".pleca_inferior .wdg_smex_strategy_01_dropdowncontent p").html(j.find("p").html());
k.bind("click","touchstart",function(m){m.preventDefault();var o=$(this).find(".wdg_smex_strategy_01_listcontainer").find(".wdg_smex_strategy_01_dropdownlist");
var p=$(this);var l=o.css("visibility");if(l=="hidden"){o.css({visibility:"visible",height:"auto","max-height":"180px","overflow-y":"scroll","overflow-x":"hidden"});
}else{o.css({visibility:"hidden",height:"0px"});}var n=$(".wdg_smex_strategy_01_dropdownlist li");n.unbind().bind("click",function(q){q.preventDefault();
$("#LoadingCancha").show();p.find(".wdg_smex_strategy_01_dropdowncontent p").html($(this).find("p").html());d.loadAlineacion(i,$(this).find("p").data("field"));
$(".wdg_smex_strategy_01 table tr td").removeClass();$(".wdg_smex_strategy_01 table tr td a").removeClass();$(".wdg_smex_strategy_01 table tr td").addClass("largo");
$(".wdg_smex_strategy_01 table tr td a").addClass("font_menu");var r=$(this).find("p").attr("data-field");$(".wdg_smex_strategy_01 .campo").hide();});});
});$("section.wdg_smex_strategy_01 .player a").live("mouseenter",function(e){e.preventDefault();$(this).children(".tooltip").css("display","block");});
$("section.wdg_smex_strategy_01 .player a").live("mouseleave",function(e){e.preventDefault();$(this).children(".tooltip").css("display","none");});if($(window).width()<948){$("section.wdg_smex_strategy_01 .player a").live("click","touchstart",function(e){e.preventDefault();
$wss1_status=$(this).children(".tooltip").css("display");if($wss1_status=="block"){$(this).children(".tooltip").css("display","none");}else{$(this).children(".tooltip").css("display","block");
}});$("section.wdg_smex_strategy_01 .player a > span").bind("touchstart",function(e){e.preventDefault();});}},botonesAlineacion:function(){var e="";a.find(".menu li").unbind().bind("click",function(f){f.preventDefault();
if(!$(this).hasClass("active")){$("#LoadingCancha").show();$(this).parent("ul").find("li").each(function(){$(this).removeClass("active");});$(this).addClass("active");
e=String($(this).children("a").data("query")).toLowerCase();switch(e){case"inicial":d.AlineacionInicial();break;case"final":d.AlineacionFinal();break;}}});
},AlineacionInicial:function(){d.loadAlineacion(a,c.ideventomxmtv);},AlineacionFinal:function(){d.loadAlineacion(a,c.ideventomxmtv,"Alineacionfinal");},header:function(){$.ajax({url:d.urlmxmheader,jsonpCallback:"mxmheader",type:"GET",dataType:"jsonp"}).done(function(e){d.timeUpdate(e.fechaPartido,e.horaPartido);
}).fail(function(){console.log("Error al cargar el header "+d.urlmxmheader);});},timeUpdate:function(h,e){var f=0;var g=h.substring(3,5)+"-"+h.substring(0,2)+"-"+h.substring(8,10)+" "+e.substring(0,5)+":00";
$.ajax({url:"http://mxm.televisadeportes.esmas.com/deportes/home/timetvjsonp.js",async:false,cache:false,dataType:"jsonp",jsonpCallback:"timetv",success:function(o){var q="";
var l=0;var k=0;horas=o.timetv;q=o.fechatv.replace(/_/gi,"-").split("-");l=parseInt(q[1])+1;if(String(l).length==1){l="0"+l;}k=parseInt(q[2])+1900;fechas=l+"-"+q[0]+"-"+k;
fechas=fechas+" "+horas+":00";var u=new Date(g);var t=new Date(fechas);var p=Date.UTC(u.getFullYear(),u.getMonth()+1,u.getDate());var n=Date.UTC(t.getFullYear(),t.getMonth()+1,t.getDate());
if(parseFloat(p)<parseFloat(n)){}else{if(parseFloat(p)==parseFloat(n)){f=60000;var j=parseInt(t.getHours()-u.getHours());if(t.getHours()>=u.getHours()){f=60000;
}else{var s=u.getHours();var r=t.getHours();var w=u.getMinutes();var v=t.getMinutes();var i=(((s-r)*60)+w)-v;if(i<=15){f=60000;}else{(i<60)?f=900000:"";
}}setInterval(function(){d.updatePlayers();},f);}else{if(parseFloat(p)>parseFloat(n)){}else{}}}}});},updatePlayers:function(){var h,f,g,e="";$.ajax({url:d.urlFinalAlienacion,type:"GET",dataType:"jsonp",jsonpCallback:"datagame"}).done(function(n){var r=new Array("lineupLocal","lineupVisit");
var j;var q,y,o;for(var p=0;p<r.length;p++){var k=String(r[p]);for(var m=0;m<n[k].substitutes.length;m++){j=n[k].substitutes[m].actions;if(typeof j!=="undefined"){for(var v=0;
v<j.length;v++){if(j[v].type.toLowerCase()==="entraaljuego"){h=$("span[data-guid="+j[v].playeridchange+"]");if(h.length){g=h.css("top");f=h.css("left");
var w="";var u="";var l="",s="";positionx=parseInt(f);positiony=parseInt(g);positionx=(isNaN(positionx))?0:positionx;positiony=(isNaN(positiony))?0:positiony;
if(positionx<=290&&positiony<=140){w="grid1";}else{if(positionx<=290&&positiony>140){w="grid3";}else{if(positionx>290&&positiony<=140){w="grid2";}else{w="grid4";
}}}if(typeof n[k].substitutes[m].actions!=="undefined"){l+='<em>acciones</em><span class="actions">';for(var t=0;t<n[k].substitutes[m].actions.length;t++){switch(n[k].substitutes[m].actions[t].type){case"golVisitante":s="tvsa-mxm-goal";
break;case"amonestacion":s="tvsa-mxm-owngoal";break;case"saleDelJuego":s="tvsa-mxm-offside";break;case"entraAlJuego":s="tvsa-mxm-goal";break;case"expulsion":s="tvsa-mxm-redcard";
break;default:s="";break;}l+='<i class="'+s+'"></i>'+n[k].substitutes[m].actions[t].minute+"'";}l+="</span>";}if(l==""){u+="noactions";}o=(r[p]==="lineupLocal")?"local":"visit";
e+='<span data-guid="'+n[k].substitutes[m].guid+'" class="player '+o+" "+w+'" style="left:'+f+";top:"+g+';display:none"><a href="#" title="'+n[k].substitutes[m].name+" "+n[k].substitutes[m].name+'"><span class="number textcolor-title2">'+n[k].substitutes[m].number+'</span><span class="tooltip '+u+'"><img class="playerfoto" src="'+n[k].substitutes[m].image+'" alt="'+n[k].substitutes[m].name+'" width="51" height="38" /><span class="arrow"></span><span class="name">'+n[k].substitutes[m].name+" "+n[k].substitutes[m].nickName+'</span><span class="position textcolor-title2">'+n[k].substitutes[m].position+"</span>"+l+"</span></a></span>";
h.fadeOut("fast",function(){$(this).remove();});}}}}}}a.find(".players").append(e).children().fadeIn("slow");}).fail(function(){console.log("error update jugadores");
});}};if(c.idclub!==0&&c.idclub!==0){d.PintaCacha("dropdown");}else{if(c.ideventomxm!==0&&c.ideventomxmtv!==0){d.PintaCacha("alineacionFinal");}}};})(jQuery);
